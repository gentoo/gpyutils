#!/usr/bin/env python

from gentoopm import get_package_manager

import sys

pm = get_package_manager()

mapping = {
	'python_targets_python2_5': '2.5',
	'python_targets_python2_6': '2.6',
	'python_targets_python2_7': '2.7',
	'python_targets_python3_1': '3.1',
	'python_targets_python3_2': '3.2',
	'python_targets_python3_3': '3.3',
	'python_targets_pypy1_8': 'p1.8',
	'python_targets_pypy1_9': 'p1.9',
	'python_targets_pypy2_0': 'p2.0',
	'python_targets_jython2_5': 'j2.5'
}

keys = sorted(mapping.values())

def process(pkgs):
	for p in pkgs.sorted:
		if 'python-r1' in p.inherits or 'python-single-r1' in p.inherits \
				or 'python-distutils-ng' in p.inherits:

			output = [' ' * len(x) for x in keys]

			for f in p.use:
				if f in mapping:
					output[keys.index(mapping[f])] = mapping[f]

			print('%40s: %s' % (p, ' '.join(output)))

if len(sys.argv) == 1:
	process(pm.stack)
else:
	for pkg in sys.argv[1:]:
		process(pm.stack.filter(pkg))
